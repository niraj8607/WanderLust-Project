<% layout('/layouts/boilerplate') %>

<style>
  
  #filters {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 2rem;
  }
  .filter {
    text-align: center;
    opacity: 0.7;
    transition: opacity 0.15s ease-in-out, transform 0.15s;
    padding: 0.35rem 0.6rem;
    border-radius: 0.5rem;
    display: inline-block;
  }
  .filter:hover { opacity: 1; cursor: pointer; transform: translateY(-3px); }
  .filter i { font-size: 1.5rem; display: block; }
  .filter p { font-size: 0.8rem; margin: 0.2rem 0 0; }
  .filter a { text-decoration: none; color: inherit; display: inline-block; }

 
  .filter.active {
    opacity: 1;
    box-shadow: 0 6px 14px rgba(0,0,0,0.08);
    transform: translateY(-4px) scale(1.03);
    border: 1px solid rgba(254,66,77,0.12);
    background: rgba(254,66,77,0.03);
  }

  
  .tax-info { display: none; font-size: 0.85rem; color: #444; }

  .listing-card img { height: 20rem; object-fit: cover; width: 100%; }
  .listing-card .card-body { padding: 0.75rem; }
</style>

<%
  // currentCategory controller se pass karein: { currentCategory: req.query.category || '' }
  const current = (typeof currentCategory !== 'undefined' && currentCategory) ? String(currentCategory).toLowerCase() : "";
  const categories = [
    { name: 'Trending', icon: 'fa-solid fa-fire' },
    { name: 'Rooms', icon: 'fa-solid fa-bed' },
    { name: 'Iconic Cities', icon: 'fa-solid fa-mountain-city' },
    { name: 'Mountains', icon: 'fa-solid fa-mountain' },
    { name: 'Castles', icon: 'fa-brands fa-fort-awesome' },
    { name: 'Amazing Pools', icon: 'fa-solid fa-person-swimming' },
    { name: 'Camping', icon: 'fa-solid fa-campground' },
    { name: 'Farms', icon: 'fa-solid fa-cow' },
    { name: 'Arctic', icon: 'fa-regular fa-snowflake' },
    { name: 'Boats', icon: 'fa-solid fa-ship' }
  ];
%>


<div id="filters">
  <% categories.forEach(cat => {
       const catKey = cat.name.toLowerCase();
       const isActive = current === catKey;
  %>
    <div class="filter <%= isActive ? 'active' : '' %>">
      <a href="/listings?category=<%= encodeURIComponent(cat.name) %>">
        <i class="<%= cat.icon %>"></i>
        <p><%= cat.name %></p>
      </a>
    </div>
  <% }) %>

  
  <div class="filter" style="align-self:center;">
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
      <label class="form-check-label" for="flexSwitchCheckDefault">Display total after taxes</label>
    </div>
  </div>
</div>


<div class="row row-cols-lg-4 row-cols-md-3 row-cols-sm-1 g-3 mt-3">
  <% if (allListings && allListings.length) { %>
    <% allListings.forEach(listing => { %>
      <div class="col">
        <a href="/listings/<%= listing._id %>" class="listing-link text-decoration-none text-dark">
          <div class="card listing-card h-100">
            <% if (listing.image && listing.image.url) { %>
              <img src="<%= listing.image.url %>" class="card-img-top" alt="listing_image">
            <% } else { %>
              <div class="card-img-top" style="height:20rem; background:#eee; display:flex; align-items:center; justify-content:center;">
                <span class="text-muted">No image</span>
              </div>
            <% } %>
            <div class="card-body">
              <p class="card-text mb-0">
                <strong><%= listing.title %></strong><br>
                <% if (typeof listing.price !== 'undefined' && listing.price !== null) { %>
                  &#8377; <%= listing.price.toLocaleString('en-IN') %> / night
                  <span class="tax-info"> &nbsp; +18% GST</span>
                <% } else { %>
                  <span class="text-muted">Price information not available</span>
                <% } %>
              </p>
            </div>
          </div>
        </a>
      </div>
    <% }) %>
  <% } else { %>
    <div class="col-12">
      <p class="text-center text-muted">No listings found.</p>
    </div>
  <% } %>
</div>


<script>
  (function () {
    const taxSwitch = document.getElementById('flexSwitchCheckDefault');
    if (!taxSwitch) return;
    // toggle display on change (safer than click)
    taxSwitch.addEventListener('change', function () {
      const infoEls = document.querySelectorAll('.tax-info');
      infoEls.forEach(el => {
        el.style.display = this.checked ? 'inline' : 'none';
      });
    });
  })();
</script>